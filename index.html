<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£é¢„è§ˆ</title>
    <meta name="description" content="æ–‡æ¡£é¢„è§ˆå·¥å…·">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fff;
            overflow: hidden;
        }
        
        /* æç®€æ¨¡å¼ - å‡ ä¹å…¨å±æ˜¾ç¤ºç›®æ ‡ç½‘ç«™ */
        .minimal-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
        }
        
        .minimal-mode .top-bar {
            height: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 12px;
            color: #6c757d;
        }
        
        .minimal-mode .content-frame {
            width: 100%;
            height: calc(100vh - 30px);
            border: none;
            display: block;
        }
        
        /* æ ‡å‡†æ¨¡å¼ - ä¿ç•™ä¸€äº›è£…é¥° */
        .standard-mode {
            padding: 10px;
        }
        
        .standard-mode .header {
            background: #fff;
            padding: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 5px;
        }
        
        .standard-mode .header h1 {
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .standard-mode .header p {
            font-size: 14px;
            color: #666;
        }
        
        .standard-mode .content-frame {
            width: 100%;
            height: calc(100vh - 120px);
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* éšè—æ¨¡å¼ - å®Œå…¨éšè—ä¸­è½¬é¡µé¢å…ƒç´  */
        .hidden-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
        }
        
        .hidden-mode .content-frame {
            width: 100%;
            height: 100vh;
            border: none;
            display: block;
        }
        
        .open-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .mode-switch {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0.3;
            transition: opacity 0.3s;
        }
        
        .mode-switch:hover {
            opacity: 1;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .standard-mode {
                padding: 5px;
            }
            
            .standard-mode .header {
                padding: 10px;
            }
            
            .standard-mode .content-frame {
                height: calc(100vh - 100px);
            }
        }
    </style>
</head>
<body>
    <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <button class="mode-switch" onclick="switchMode()" title="åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼">æ¨¡å¼</button>
    
    <!-- åŠ è½½æç¤º -->
    <div id="loading" class="loading">æ­£åœ¨åŠ è½½...</div>
    
    <!-- æç®€æ¨¡å¼ -->
    <div id="minimal-container" class="minimal-mode" style="display: none;">
        <div class="top-bar">
            <span>æ–‡æ¡£é¢„è§ˆ</span>
            <button class="open-btn" onclick="openInBrowser()">æµè§ˆå™¨æ‰“å¼€</button>
        </div>
        <iframe id="minimal-frame" class="content-frame"></iframe>
    </div>
    
    <!-- æ ‡å‡†æ¨¡å¼ -->
    <div id="standard-container" class="standard-mode" style="display: none;">
        <div class="header">
            <h1>ğŸ“„ æ–‡æ¡£é¢„è§ˆ</h1>
            <p>å®‰å…¨é¢„è§ˆæ–‡æ¡£å†…å®¹</p>
        </div>
        <iframe id="standard-frame" class="content-frame"></iframe>
    </div>
    
    <!-- éšè—æ¨¡å¼ -->
    <div id="hidden-container" class="hidden-mode" style="display: none;">
        <iframe id="hidden-frame" class="content-frame"></iframe>
    </div>

    <script>
        // æ˜¾ç¤ºæ¨¡å¼ï¼š0=æç®€, 1=æ ‡å‡†, 2=éšè—
        let currentMode = 0;
        
        // è·å–ç›®æ ‡URL
        const getTargetUrl = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const target = urlParams.get('url') || urlParams.get('u') || urlParams.get('link');
            
            // æ”¯æŒbase64ç¼–ç çš„URL
            if (target && target.includes('base64:')) {
                try {
                    return atob(target.replace('base64:', ''));
                } catch (e) {
                    console.error('Base64 decode failed:', e);
                }
            }
            
            return target ? decodeURIComponent(target) : 'https://example.com';
        };
        
        // æ£€æµ‹ç¯å¢ƒ
        const isWeChat = () => /MicroMessenger/i.test(navigator.userAgent);
        const isMobile = () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼
        const switchMode = () => {
            currentMode = (currentMode + 1) % 3;
            showCurrentMode();
            loadContent();
        };
        
        // æ˜¾ç¤ºå½“å‰æ¨¡å¼
        const showCurrentMode = () => {
            const containers = ['minimal-container', 'standard-container', 'hidden-container'];
            
            containers.forEach((id, index) => {
                const element = document.getElementById(id);
                element.style.display = index === currentMode ? 'block' : 'none';
            });
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            const modeNames = ['æç®€', 'æ ‡å‡†', 'éšè—'];
            document.querySelector('.mode-switch').textContent = modeNames[currentMode];
        };
        
        // åŠ è½½å†…å®¹
        const loadContent = () => {
            const targetUrl = getTargetUrl();
            const frameIds = ['minimal-frame', 'standard-frame', 'hidden-frame'];
            const currentFrame = document.getElementById(frameIds[currentMode]);
            
            if (!currentFrame) return;
            
            // ç§»é™¤æ‰€æœ‰sandboxé™åˆ¶ï¼Œå…è®¸å®Œæ•´äº¤äº’
            currentFrame.removeAttribute('sandbox');
            
            // è®¾ç½®iframeå±æ€§ä»¥æ”¯æŒå®Œæ•´åŠŸèƒ½
            currentFrame.setAttribute('allowfullscreen', 'true');
            currentFrame.setAttribute('allow', 'camera; microphone; geolocation; payment; autoplay; encrypted-media');
            
            // åŠ è½½ç›®æ ‡URL
            currentFrame.src = targetUrl;
            
            // å¤„ç†åŠ è½½å®Œæˆ
            currentFrame.onload = () => {
                document.getElementById('loading').style.display = 'none';
                
                // å°è¯•éšè—æ»šåŠ¨æ¡ï¼ˆå¦‚æœå¯èƒ½ï¼‰
                try {
                    const frameDoc = currentFrame.contentDocument || currentFrame.contentWindow.document;
                    if (frameDoc) {
                        const style = frameDoc.createElement('style');
                        style.textContent = `
                            body { 
                                margin: 0 !important; 
                                padding: 0 !important;
                            }
                            ::-webkit-scrollbar { width: 0px; background: transparent; }
                        `;
                        frameDoc.head.appendChild(style);
                    }
                } catch (e) {
                    // è·¨åŸŸé™åˆ¶ï¼Œå¿½ç•¥é”™è¯¯
                    console.log('Cross-origin restrictions apply');
                }
            };
            
            // å¤„ç†åŠ è½½é”™è¯¯
            currentFrame.onerror = () => {
                document.getElementById('loading').innerHTML = 'åŠ è½½å¤±è´¥ï¼Œè¯·å°è¯•ç›´æ¥è®¿é—®';
            };
        };
        
        // åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
        const openInBrowser = () => {
            const targetUrl = getTargetUrl();
            
            if (isWeChat()) {
                // å¾®ä¿¡ç¯å¢ƒæç¤º
                alert('è¯·ç‚¹å‡»å³ä¸Šè§’èœå•ï¼Œé€‰æ‹©"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"');
            } else {
                window.open(targetUrl, '_blank');
            }
        };
        
        // è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å¼
        const autoSelectMode = () => {
            if (isWeChat()) {
                // å¾®ä¿¡ä¸­ä½¿ç”¨æç®€æ¨¡å¼
                currentMode = 0;
            } else if (isMobile()) {
                // ç§»åŠ¨ç«¯ä½¿ç”¨éšè—æ¨¡å¼
                currentMode = 2;
            } else {
                // æ¡Œé¢ç«¯ä½¿ç”¨æ ‡å‡†æ¨¡å¼
                currentMode = 1;
            }
            
            // æ£€æŸ¥URLå‚æ•°ä¸­çš„æ¨¡å¼è®¾ç½®
            const urlParams = new URLSearchParams(window.location.search);
            const modeParam = urlParams.get('mode');
            if (modeParam && ['0', '1', '2'].includes(modeParam)) {
                currentMode = parseInt(modeParam);
            }
        };
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            autoSelectMode();
            showCurrentMode();
            loadContent();
            
            // 5ç§’åè‡ªåŠ¨éšè—æ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼ˆåœ¨éšè—æ¨¡å¼ä¸‹ï¼‰
            if (currentMode === 2) {
                setTimeout(() => {
                    document.querySelector('.mode-switch').style.display = 'none';
                }, 5000);
            }
        });
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // Ctrl+M åˆ‡æ¢æ¨¡å¼
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                switchMode();
            }
            
            // Ctrl+O åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                openInBrowser();
            }
        });
    </script>
</body>
</html>
